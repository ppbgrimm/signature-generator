<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.Grimm Signature Generator</title>
    <style>
        /* --- GLOBAL SETTINGS (MASTER STYLE) --- */
        :root {
            --body-side-padding: 20px;
            --logo-min-h: 30px;
            --logo-pref-h: 5vw;
            --logo-max-h: 50px;
            --primary-orange: #FF6727;
            --gold-theme: #8C704D;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 140px; 
            padding-bottom: 30px;
            padding-left: var(--body-side-padding);
            padding-right: var(--body-side-padding);
            color: #63666F;
            min-height: 100vh;
            box-sizing: border-box;
            transition: background-color 0.5s;
        }
        
        input, button, .tab-btn, h1, h2, h3, h4, .sub-header, li, p {
            font-family: Arial, sans-serif;
        }

        /* --- HEADER --- */
        .main-header {
            position: fixed; z-index: 2000; left: 0; right: 0; margin: 0 auto;
            top: 0; width: 100%; border-radius: 0; padding: 20px 0;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-sizing: border-box; display: flex; justify-content: center;
        }
        .main-header.scrolled {
            top: 20px; width: 95%; max-width: 1140px; border-radius: 60px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 15px 40px rgba(31, 38, 135, 0.12);
            background: rgba(255, 255, 255, 0.9); padding: 10px 0;
        }
        .header-inner { width: 100%; max-width: 1100px; padding: 0 30px; display: flex; justify-content: space-between; align-items: center; }
        .header-logo img { height: clamp(var(--logo-min-h), var(--logo-pref-h), var(--logo-max-h)); width: auto; display: block; transition: height 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .main-header.scrolled .header-logo img { height: clamp(25px, 4vw, 35px); }
        .header-titles { text-align: right; transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        .header-title-en {
            font-size: clamp(14px, 2.5vw, 26px); font-weight: 700; margin-bottom: 2px; letter-spacing: -0.5px;
            background: linear-gradient(120deg, #FF6727 0%, #FF8C00 15%, #FF6727 30%, #FFE3B3 45%, #FF6727 60%, #FF4500 75%, #FF6727 90%);
            background-size: 400% 400%; color: #FF6727; -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
            animation: moltenChaos 25s ease infinite; transition: font-size 0.6s;
        }
        .header-title-th { font-size: clamp(10px, 1.5vw, 16px); color: #63666F; transition: font-size 0.6s; }
        .main-header.scrolled .header-title-en { font-size: clamp(12px, 2vw, 18px); }
        .main-header.scrolled .header-title-th { font-size: clamp(9px, 1.2vw, 12px); opacity: 0.8; }
        @keyframes moltenChaos { 0% { background-position: 10% 15%; } 50% { background-position: 15% 60%; } 100% { background-position: 10% 15%; } }

        /* --- CONTAINER --- */
        .container { 
            display: flex; gap: 30px; 
            background: white; padding: 30px; 
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            width: 100%; max-width: 1100px; 
            flex-wrap: wrap; margin-bottom: 40px; margin-top: 0; 
            align-items: flex-start;
        }
        .input-section { flex: 1; min-width: 320px; border-right: 1px solid #ddd; padding-right: 30px; }
        .preview-section { flex: 1.5; min-width: 320px; display: flex; flex-direction: column; }
        h2 { margin: 0; color: #8C704D; font-size: 22px; margin-bottom: 5px; }
        .sub-header { color: #777; font-size: 14px; margin-bottom: 20px; font-weight: 400; }
        .input-section h3 { margin: 15px 0 10px; font-size: 15px; color: #8C704D; border-bottom: 1px solid #eee; padding-bottom: 5px; font-weight: 700; }

        /* --- INPUTS --- */
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 5px; font-weight: 700; font-size: 13px; color: #666; }
        input { width: 100%; padding: 10px; padding-right: 35px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; box-sizing: border-box; transition: all 0.3s ease; color: #63666F; }
        input:focus { border-color: #C8B273; box-shadow: 0 0 0 3px rgba(200, 178, 115, 0.2); outline: none; }
        input.input-error { border-color: #dc3545 !important; background-color: #fff8f8; }
        
        ::placeholder { color: #a8a8a8; opacity: 1; }
        
        .valid-icon { position: absolute; right: 12px; top: 32px; color: #28a745; font-size: 16px; display: none; pointer-events: none; font-weight: bold; }
        
        /* === GLOBAL SYNCED ANIMATION SYSTEM === */
        .warning-msg { position: relative; height: 20px; overflow: hidden; color: #dc3545; font-size: 12px; font-weight: 700; margin-top: 4px; display: none; }
        .custom-placeholder { position: absolute; top: 32px; left: 11px; pointer-events: none; width: 85%; height: 20px; overflow: hidden; z-index: 5; }
        
        .warning-msg span, .custom-placeholder span {
            position: absolute; top: 0; left: 0; width: 100%; 
            white-space: nowrap; transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .custom-placeholder span { font-size: 14px; color: #a8a8a8; font-family: Arial, sans-serif; }
        .warning-msg span { font-size: 12px; color: #dc3545; font-weight: 700; }

        body[data-lang-state="th"] .custom-placeholder .th, body[data-lang-state="th"] .warning-msg .th { opacity: 1; transform: translateY(0); }
        body[data-lang-state="th"] .custom-placeholder .en, body[data-lang-state="th"] .warning-msg .en { opacity: 0; transform: translateY(10px); }
        body[data-lang-state="en"] .custom-placeholder .th, body[data-lang-state="en"] .warning-msg .th { opacity: 0; transform: translateY(-10px); }
        body[data-lang-state="en"] .custom-placeholder .en, body[data-lang-state="en"] .warning-msg .en { opacity: 1; transform: translateY(0); }

        .format-hint { font-size: 11px; color: #888; margin-top: 2px; }

        /* --- TABS (SMOOTH SLIDE - NO BOUNCE) --- */
        .toggle-container { position: relative; display: flex; background: #f5f5f5; padding: 6px; border-radius: 12px; margin-bottom: 25px; }
        .tab-btn { 
            flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 8px; margin: 0; 
            font-size: 14px; color: #666; font-weight: 400 !important; 
            border: 1px solid transparent; background: transparent; z-index: 2; position: relative; 
            transition: color 0.3s ease; 
        }
        .tab-btn.active { color: white; }
        .tab-slider { 
            position: absolute; top: 6px; left: 6px; bottom: 6px; 
            background-color: #8C704D; border-radius: 8px; z-index: 1; 
            /* Smooth Cubic Bezier without Overshoot */
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1); 
            width: 0; 
        }

        /* --- PREVIEW BOX --- */
        .signature-box { border: 2px dashed #ccc; padding: 20px; margin-top: 10px; border-radius: 12px; background: #fff; min-height: 200px; }
        .mobile-preview-container { max-width: 320px; margin: 0 auto; border: 1px solid #eee; padding: 15px; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); white-space: pre-wrap; font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; color: #000; }
        
        /* COPY BUTTON STYLE */
        .btn-copy { 
            background: linear-gradient(180deg, #997b55 0%, #8C704D 100%); 
            color: white; border: none; padding: 14px 24px; border-radius: 50px; 
            font-size: 15px; cursor: pointer; font-weight: 700; 
            margin-top: 20px; width: 100%; 
            letter-spacing: 0.5px; 
            box-shadow: 0 4px 6px rgba(140, 112, 77, 0.2); 
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); 
            position: relative; overflow: hidden; 
        }
        .btn-copy:hover { transform: translateY(-2px); background: linear-gradient(180deg, #a3845c 0%, #967853 100%); box-shadow: 0 8px 15px rgba(140, 112, 77, 0.35); }
        .btn-copy:active { transform: translateY(1px) scale(0.98); box-shadow: 0 2px 4px rgba(140, 112, 77, 0.2); }
        .btn-copy::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0)); opacity: 0; transition: opacity 0.2s; }
        .btn-copy:hover::after { opacity: 1; }
        
        .note { font-size: 12px; color: #666; margin-top: 10px; background: #fff3cd; padding: 10px; border-radius: 4px; text-align: center; }
        .form-container { display: none; }
        .form-container.active { display: block; animation: fadeIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }
        #contactSection { animation: fadeIn 0.6s cubic-bezier(0.25, 0.8, 0.25, 1); }
        #previewDesktop, #previewMobile { display: none; }
        #previewDesktop.active, #previewMobile.active { display: block; animation: fadeIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }

        /* --- FLOAT BTN (PREMIUM SOFT JELLY) --- */
        .float-wrapper {
            position: fixed; bottom: 30px; right: 30px; z-index: 1000;
            animation: slowFloat 6s ease-in-out infinite; 
            pointer-events: auto;
            transition: opacity 0.4s ease, visibility 0.4s ease, transform 0.4s ease;
        }
        .float-wrapper.hidden { opacity: 0; visibility: hidden; pointer-events: none; transform: translateY(20px); }

        .float-guide-btn { 
            background: linear-gradient(135deg, #8C704D 0%, #C8B273 100%); 
            color: white; border: none; border-radius: 50px; 
            padding: 12px 20px; font-weight: 700; font-size: 14px; 
            box-shadow: 0 6px 20px rgba(140, 112, 77, 0.4); 
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: box-shadow 0.3s ease, background 0.3s ease;
            transform-origin: center bottom;
        }

        .float-guide-btn:hover { box-shadow: 0 12px 30px rgba(140, 112, 77, 0.5); }

        .jelly-pop { animation: premiumJelly 0.6s cubic-bezier(0.25, 1.5, 0.5, 1) forwards; }

        @keyframes premiumJelly {
            0% { transform: scale(1, 1); }
            30% { transform: scale(1.08, 0.92); } 
            50% { transform: scale(0.95, 1.05); } 
            70% { transform: scale(1.02, 0.98); } 
            100% { transform: scale(1, 1); }
        }
        
        @keyframes slowFloat { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-8px); } 
        }
        
        .icon-bubble { font-size: 18px; background: rgba(255,255,255,0.2); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        
        .bubble-text-wrapper { 
            display: inline-block; white-space: nowrap; overflow: hidden; 
            position: relative; height: 20px; 
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); 
            vertical-align: middle;
        }
        .bubble-text-wrapper span { position: absolute; top: 2px; left: 0; transition: opacity 0.3s ease; }

        /* --- GUIDE --- */
        .guide-container { width: 100%; max-width: 1100px; display: flex; flex-direction: column; gap: 10px; scroll-margin-top: 20px; }
        .guide-header-row { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 1100px; margin-bottom: 20px; border-bottom: 2px solid #C8B273; padding-bottom: 10px; scroll-margin-top: 40px; }
        .guide-section-title { color: #8C704D; font-size: 20px; font-weight: 700; margin: 0; }
        .accordion { background-color: #fff; color: #63666F; cursor: pointer; padding: 18px 25px; width: 100%; border: 1px solid #e0e0e0; text-align: left; outline: none; font-size: 16px; font-weight: 700; transition: all 0.3s ease; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .accordion:hover { color: #8C704D; border-color: #C8B273; background-color: #fffbf5; transform: translateY(-1px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .accordion.active { background-color: #fff; color: #8C704D; border-color: #8C704D; border-bottom-left-radius: 0; border-bottom-right-radius: 0; box-shadow: 0 4px 10px rgba(140, 112, 77, 0.1); }
        .accordion .icon { font-size: 12px; color: #989AA5; transition: transform 0.3s ease; }
        .accordion.active .icon { transform: rotate(180deg); color: #8C704D; }
        .panel { padding: 0 25px; background-color: #fff; max-height: 0; overflow: hidden; border: 1px solid #8C704D; border-top: none; border-radius: 0 0 10px 10px; margin-top: -10px; margin-bottom: 5px; opacity: 0; transform: translateY(-5px); transition: all 0.3s ease; }
        .panel.show { padding: 25px; max-height: 1000px; opacity: 1; transform: translateY(0); margin-bottom: 15px; }
        .panel h4 { color: #8C704D; margin: 15px 0 5px; font-size: 15px; font-weight: 700; }
        .panel p { font-size: 14px; color: #63666F; line-height: 1.6; margin-bottom: 10px; }
        .panel ul, .panel ol { padding-left: 20px; color: #63666F; font-size: 14px; line-height: 1.8; }
        .panel li { margin-bottom: 5px; }
        .panel code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; color: #63666F; font-family: monospace; border: 1px solid #989AA5; font-weight: 700; }
        .panel em { color: #989AA5; font-size: 13px; font-style: italic; }
        
        /* UI TAGS */
        .ui-tag {
            display: inline-block; padding: 1px 6px; background-color: #f8f9fa;
            border: 1px solid #c8b273; border-radius: 4px;
            color: #555; font-size: 11px; font-weight: 700;
            box-shadow: 0 1px 0 rgba(0,0,0,0.1); margin: 0 2px;
        }

        .lang-switch { display: flex; gap: 10px; font-size: 14px; font-weight: 700; }
        .lang-btn { cursor: pointer; color: #989AA5; transition: color 0.2s; }
        .lang-btn:hover { color: #C8B273; }
        .lang-btn.active { color: #8C704D; text-decoration: underline; }
        .lang-divider { color: #C8B273; }
        [data-lang="th"] { display: block; } [data-lang="en"] { display: none; }

        .app-footer { margin-top: 30px; color: #989AA5; font-size: 13px; text-align: center; padding-bottom: 20px; width: 100%; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* RESPONSIVE STICKY */
        @media (max-width: 768px) { 
            .container { flex-direction: column; } 
            .input-section { border-right: none; padding-right: 0; border-bottom: 1px solid #ddd; padding-bottom: 20px; } 
            .float-guide-btn { bottom: 20px; right: 20px; padding: 10px 20px; font-size: 12px; } 
            .header-titles { text-align: left; } 
        }
        @media (min-width: 769px) {
            .preview-section {
                position: sticky;
                top: 130px; /* Offset below header */
                align-self: flex-start;
            }
        }
    </style>
</head>
<body data-lang-state="th">

<header class="main-header" id="stickyHeader">
    <div class="header-inner">
        <div class="header-logo"><img src="https://static-portal.bgrimm.io/public/logo/B.Grimm%20Logo.png" alt="B.Grimm Logo"></div>
        <div class="header-titles">
            <div class="header-title-en">Email Signature Generator</div>
            <div class="header-title-th">เครื่องมือสร้างลายเซ็นอีเมล</div>
        </div>
    </div>
</header>

<div id="floatWrapper" class="float-wrapper">
    <button id="floatGuideBtn" class="float-guide-btn" onclick="scrollToGuide()">
        <span class="icon-bubble">?</span> 
        <div class="bubble-text-wrapper" id="bubbleTextWrapper">
            <span id="bubbleText">วิธีติดตั้ง?</span>
        </div>
    </button>
</div>
<span id="textMeasurer" style="visibility: hidden; position: absolute; font-size: 14px; font-weight: 700; font-family: Arial; white-space: nowrap;">วิธีติดตั้ง?</span>

<div class="container">
    <div class="input-section">
        <h2>Enter Information</h2>
        <div class="sub-header">กรอกข้อมูลพนักงานหรือหน่วยงาน</div>
        <div class="toggle-container" id="modeSelector">
            <div class="tab-slider" id="modeSlider"></div>
            <button class="tab-btn active" id="btnPerson" onclick="setMode('person', this)">พนักงาน (Person)</button>
            <button class="tab-btn" id="btnDept" onclick="setMode('dept', this)">หน่วยงาน (Department)</button>
        </div>

        <div id="formPerson" class="form-container active">
            <h3>ข้อมูลส่วนตัว (Personal Info)</h3>
            <div class="form-group">
                <label>ชื่อ-นามสกุล ภาษาอังกฤษ (Name - EN)</label>
                <input type="text" id="pNameEng" placeholder="Somchai Jaidee" oninput="updateSig()">
                <span id="checkNameEng" class="valid-icon">✓</span>
                <div class="anim-wrapper warning-msg warning-mode" id="warnNameEng"></div>
            </div>
            <div class="form-group">
                <label>ชื่อ-นามสกุล ภาษาไทย (Name - TH)</label>
                <input type="text" id="pNameTh" placeholder="สมชาย ใจดี" oninput="updateSig()">
                <span id="checkNameTh" class="valid-icon">✓</span>
                <div class="anim-wrapper warning-msg warning-mode" id="warnNameTh"></div>
            </div>
            
            <h3>ตำแหน่งงาน (Job Details)</h3>
            <div class="form-group">
                <label>ตำแหน่ง (Position)</label>
                <input type="text" id="pPosition" oninput="checkPh(this); updateSig();">
                <div class="anim-wrapper custom-placeholder" id="ph_pPosition"><span class="th">ถ้าว่างจะซ่อน</span><span class="en">Hidden if empty</span></div>
                <div class="anim-wrapper warning-msg warning-mode" id="warnPos">
                    <span class="th">⚠️ กรุณากรอกชื่อตำแหน่งงาน</span><span class="en">⚠️ Please fill in job title</span>
                </div>
            </div>
            <div class="form-group">
                <label>แผนก/ส่วนงาน (Section/Solutions)</label>
                <input type="text" id="pSection" oninput="checkPh(this); updateSig();">
                <div class="anim-wrapper custom-placeholder" id="ph_pSection"><span class="th">ถ้าว่างจะซ่อน</span><span class="en">Hidden if empty</span></div>
            </div>
            <div class="form-group">
                <label>ฝ่าย (Department)</label>
                <input type="text" id="pDepartment" oninput="checkPh(this); updateSig();">
                <div class="anim-wrapper custom-placeholder" id="ph_pDepartment"><span class="th">ถ้าว่างจะซ่อน</span><span class="en">Hidden if empty</span></div>
            </div>
        </div>

        <div id="formDept" class="form-container">
            <h3>ข้อมูลหน่วยงาน (Department Info)</h3>
            <div class="form-group"><label>ชื่อหน่วยงาน ภาษาอังกฤษ (Dept Name - EN)</label><input type="text" id="dNameEng" placeholder="Human Resources" oninput="updateSig()"><span id="checkDeptEng" class="valid-icon">✓</span><div class="anim-wrapper warning-msg warning-mode" id="warnDeptEng"></div></div>
            <div class="form-group"><label>ชื่อหน่วยงาน ภาษาไทย (Dept Name - TH)</label>
                <input type="text" id="dNameTh" oninput="checkPh(this); updateSig()">
                <div class="anim-wrapper custom-placeholder" id="ph_dNameTh"><span class="th">ถ้าว่างจะซ่อน</span><span class="en">Hidden if empty</span></div>
                <span id="checkDeptTh" class="valid-icon">✓</span><div class="anim-wrapper warning-msg warning-mode" id="warnDeptTh"></div>
            </div>
        </div>

        <div id="contactSection">
            <h3>ข้อมูลองค์กร & ที่อยู่ (Organization & Location)</h3>
            <div class="form-group">
                <label>ชื่อบริษัท (Company Name) <span style="font-weight:normal; color:#888;">(Optional)</span></label>
                <input type="text" id="inputCompany" oninput="checkPh(this); updateSig();">
                <span id="checkCompany" class="valid-icon">✓</span><div class="anim-wrapper warning-msg warning-mode" id="warnCompany"></div>
                <div class="anim-wrapper custom-placeholder" id="ph_inputCompany"><span class="th">ว่าง = B.Grimm Power PCL</span><span class="en">Empty = B.Grimm Power PCL</span></div>
            </div>
            <div class="form-group">
                <label>ที่อยู่ (Address) <span style="font-weight:normal; color:#888;">(Optional)</span></label>
                <input type="text" id="inputAddress" oninput="checkPh(this); updateSig();">
                <div class="anim-wrapper custom-placeholder" id="ph_inputAddress"><span class="th">ว่าง = ใช้ที่อยู่ สนญ.</span><span class="en">Empty = Default HQ</span></div>
            </div>

            <h3>ช่องทางติดต่อ (Contact Channels)</h3>
            <div class="form-group"><label>เบอร์มือถือ (Mobile)</label><input type="text" id="inputMobile" maxlength="10" oninput="checkPh(this); updateSig()">
                <div class="anim-wrapper custom-placeholder" id="ph_inputMobile"><span class="th">ถ้าว่างจะซ่อน</span><span class="en">Hidden if empty</span></div>
                <span id="checkMobile" class="valid-icon">✓</span><div class="format-hint">พิมพ์ 10 หลัก (ไม่ต้องใส่ขีด)</div><div class="anim-wrapper warning-msg warning-mode" id="warnMobile"></div>
            </div>
            <div class="form-group"><label>เบอร์โทรศัพท์ (Telephone)</label><input type="text" id="inputTel" maxlength="9" oninput="checkPh(this); updateSig()">
                <div class="anim-wrapper custom-placeholder" id="ph_inputTel"><span class="th">ถ้าว่างจะซ่อน</span><span class="en">Hidden if empty</span></div>
                <span id="checkTel" class="valid-icon">✓</span><div class="format-hint">พิมพ์ 9 หลัก (ไม่ต้องใส่ขีด)</div><div class="anim-wrapper warning-msg warning-mode" id="warnTel"></div>
            </div>
            <div class="form-group"><label>อีเมล (Email)</label><input type="email" id="inputEmail" placeholder="example@bgrimmpower.com" oninput="updateSig()"><span id="checkEmail" class="valid-icon">✓</span><div class="anim-wrapper warning-msg warning-mode" id="warnEmail"></div></div>
            <div class="form-group">
                <label>เว็บไซต์ (Website) <span style="font-weight:normal; color:#888;">(Optional)</span></label>
                <input type="text" id="inputWebsite" oninput="checkPh(this); updateSig();">
                <div class="anim-wrapper custom-placeholder" id="ph_inputWebsite"><span class="th">ว่าง = www.bgrimmpower.com</span><span class="en">Empty = www.bgrimmpower.com</span></div>
            </div>
        </div>
    </div>

    <div class="preview-section">
        <h2>Select Template & Copy</h2>
        <div class="sub-header">เลือกรูปแบบที่ต้องการแล้วกดปุ่มคัดลอก</div>
        <div class="toggle-container preview-tabs" id="previewTabs">
            <div class="tab-slider" id="previewSlider"></div>
            <button class="tab-btn active" id="btnDesktop" onclick="switchTab('desktop', this)">Desktop</button>
            <button class="tab-btn" id="btnMobile" onclick="switchTab('mobile', this)">Mobile</button>
        </div>

        <div class="signature-box" id="signatureBox">
            <div id="previewDesktop" class="active">
                <style> a.sig-link { color:#63666F; text-decoration:none; } a.sig-link:hover{text-decoration:underline;color:#FF6727;} </style>
                <div style="font-family:Arial, sans-serif; font-size:12px; color:#63666F; margin-bottom: 10px;">--</div>
                <table cellpadding="0" cellspacing="0" border="0" style="font-family:Arial, sans-serif; font-size:12px; color:#63666F; line-height: 1.4;">
                  <tr><td style="padding-bottom:12px;"><img src="https://static-portal.bgrimm.io/public/logo/B.Grimm%20Logo.png" width="120" alt="B.Grimm Logo" border="0" style="display:block;"></td></tr>
                  <tr><td style="padding-bottom:2px;"><strong id="sigNameContent" style="font-size:12px; color:#FF6727;"></strong></td></tr>
                  <tr id="rowPosition"><td style="padding-bottom:2px;"><span id="prevPos"></span></td></tr>
                  <tr><td style="padding-bottom:2px;"><strong style="color:#63666F;" id="sigCompany">B.Grimm Power PCL</strong> <span style="color:#63666F;">&nbsp;|&nbsp;</span> <span id="sigAddress">Dr. Gerhard Link Building, 5 Krungthepkreetha Road, Bangkok 10240, Thailand</span></td></tr>
                  <tr id="rowPhones"><td style="padding-bottom:2px;"><span id="wrapMob"><strong>Mobile</strong> <a id="linkMobile" href="#" class="sig-link"></a></span><span id="wrapTel"></span></td></tr>
                  <tr><td><strong>Email</strong> <a id="linkEmail" href="#" class="sig-link"></a> <span style="color:#63666F;">&nbsp;|&nbsp;</span> <a href="https://www.bgrimmpower.com" class="sig-link" id="sigWebsite">www.bgrimmpower.com</a></td></tr>
                </table>
            </div>
            <div id="previewMobile">
                <div class="mobile-preview-container" id="mobContent">Loading...</div>
            </div>
        </div>
        <button class="btn-copy" onclick="copySignature()">Copy to Clipboard</button>
        <div class="note"><span id="noteText"><strong>Desktop:</strong> เหมาะสำหรับ Outlook บนคอมพิวเตอร์</span></div>
    </div>
</div>

<div class="guide-header-row" id="guide-anchor">
    <h2 class="guide-section-title" id="guideTitle">คู่มือการตั้งค่า (Installation Guide)</h2>
    <div class="lang-switch">
        <span class="lang-btn active" id="btnTh" onclick="setGuideLang('th')">TH</span><span class="lang-divider">|</span><span class="lang-btn" id="btnEn" onclick="setGuideLang('en')">EN</span>
    </div>
</div>

<div class="guide-container">
    <button class="accordion" id="acc-item-1"><span data-lang="th">1. Microsoft Outlook (Desktop App)</span><span data-lang="en">1. Microsoft Outlook (Desktop App)</span><span class="icon">▼</span></button>
    <div class="panel">
        <div data-lang="th"><h4>สำหรับ New Outlook (เวอร์ชันใหม่)</h4><ol><li>คลิก <span class="ui-tag">Settings ⚙️</span> > <span class="ui-tag">Accounts</span> > <span class="ui-tag">Signatures</span></li><li><span class="ui-tag">+ New Signature</span> ตั้งชื่อ "B.Grimm"</li><li>ในกล่องข้อความให้กดปุ่ม <code>Ctrl + V</code> เพื่อวางลายเซ็น</li><li>เลือก Default Signature ทั้ง New/Replies เป็น "B.Grimm" แล้วกด <span class="ui-tag">Save</span></li></ol><h4>สำหรับ Classic Outlook</h4><ol><li><span class="ui-tag">File</span> > <span class="ui-tag">Options</span> > <span class="ui-tag">Mail</span> > <span class="ui-tag">Signatures</span></li><li><span class="ui-tag">New</span> > ตั้งชื่อ > วางลายเซ็นโดยกดปุ่ม <code>Ctrl + V</code></li><li>เลือก Default แล้วกด <span class="ui-tag">OK</span></li></ol></div>
        <div data-lang="en"><h4>For New Outlook</h4><ol><li><span class="ui-tag">Settings ⚙️</span> > <span class="ui-tag">Accounts</span> > <span class="ui-tag">Signatures</span></li><li><span class="ui-tag">New</span> > Paste by pressing <code>Ctrl + V</code> > Set Default > <span class="ui-tag">Save</span></li></ol></div>
    </div>
    <button class="accordion"><span data-lang="th">2. Outlook on the Web (Microsoft 365)</span><span data-lang="en">2. Outlook on the Web (Microsoft 365)</span><span class="icon">▼</span></button>
    <div class="panel">
        <div data-lang="th">
            <ol>
                <li>ไปที่ Outlook บนเว็บ คลิก <span class="ui-tag">Settings ⚙️</span> ที่มุมขวาบน</li>
                <li>เลือกเมนู <span class="ui-tag">Mail</span> ทางด้านซ้าย แล้วเลือก <span class="ui-tag">Compose and reply</span></li>
                <li><em>หมายเหตุ: หากไม่พบเมนูนี้ ให้ลองไปที่ <span class="ui-tag">Accounts</span> > <span class="ui-tag">Signatures</span></em></li>
                <li>ที่หัวข้อ <strong>Email signature</strong> ให้คลิกปุ่ม <span class="ui-tag">+ New signature</span></li>
                <li>ตั้งชื่อลายเซ็น แล้วคลิกในกล่องข้อความเพื่อวางข้อมูลโดยกดปุ่ม <code>Ctrl + V</code></li>
                <li>ที่หัวข้อ <strong>Select default signatures</strong> ให้เลือกชื่อลายเซ็นใหม่ของคุณในทั้ง 2 ช่อง</li>
                <li>กดปุ่ม <span class="ui-tag">Save</span></li>
            </ol>
        </div>
        <div data-lang="en">
            <ol>
                <li>Go to Outlook Web > Click <span class="ui-tag">Settings ⚙️</span> (top right)</li>
                <li>Select <span class="ui-tag">Mail</span> > <span class="ui-tag">Compose and reply</span></li>
                <li><em>Note: If missing, check <span class="ui-tag">Accounts</span> > <span class="ui-tag">Signatures</span></em></li>
                <li>Under <strong>Email signature</strong>, click <span class="ui-tag">+ New signature</span></li>
                <li>Name it, then click inside the box and paste by pressing <code>Ctrl + V</code></li>
                <li>Under <strong>Select default signatures</strong>, choose your new signature for both options</li>
                <li>Click <span class="ui-tag">Save</span></li>
            </ol>
        </div>
    </div>
    <button class="accordion"><span data-lang="th">3. Google Workspace (Gmail)</span><span data-lang="en">3. Google Workspace (Gmail)</span><span class="icon">▼</span></button>
    <div class="panel">
        <div data-lang="th"><ol><li><span class="ui-tag">Settings ⚙️</span> > <span class="ui-tag">See all settings</span></li><li><span class="ui-tag">Signature</span> > <span class="ui-tag">+ Create new</span> > วางโดยกดปุ่ม <code>Ctrl + V</code></li><li>Signature defaults เลือกชื่อลายเซ็น > <span class="ui-tag">Save Changes</span></li></ol></div>
        <div data-lang="en"><ol><li><span class="ui-tag">Settings ⚙️</span> > <span class="ui-tag">All settings</span> > <span class="ui-tag">Signature</span></li><li><span class="ui-tag">Create</span> > Paste by pressing <code>Ctrl + V</code> > Set Defaults > <span class="ui-tag">Save</span></li></ol></div>
    </div>
    <button class="accordion"><span data-lang="th">4. Mobile (Outlook App)</span><span data-lang="en">4. Mobile (Outlook App)</span><span class="icon">▼</span></button>
    <div class="panel">
        <div data-lang="th"><ol><li>เปลี่ยน Tab ด้านบนเป็น <strong>Mobile</strong> แล้วกด <span class="ui-tag">Copy to Clipboard</span></li><li>ในแอป Outlook แตะรูปโปรไฟล์ > <span class="ui-tag">Settings ⚙️</span></li><li><span class="ui-tag">Signature</span> > ลบของเก่า > กดวาง (Paste)</li></ol></div>
        <div data-lang="en"><ol><li>Switch to <strong>Mobile</strong> tab > <span class="ui-tag">Copy to Clipboard</span></li><li>Outlook App > <span class="ui-tag">Settings</span> > <span class="ui-tag">Signature</span> > Paste</li></ol></div>
    </div>
</div>

<footer class="app-footer">© 2026 B.Grimm, Digital and Energy Solutions</footer>

<script>
    /* SYNC ANIMATION */
    setInterval(() => {
        const body = document.body;
        body.setAttribute('data-lang-state', body.getAttribute('data-lang-state') === 'th' ? 'en' : 'th');
    }, 3000);

    /* UI LOGIC (Accordion) */
    document.addEventListener("DOMContentLoaded", function() {
        const acc = document.getElementsByClassName("accordion");
        for (let i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function() {
                this.classList.toggle("active");
                const panel = this.nextElementSibling;
                panel.classList.toggle("show");
            });
        }
    });

    /* MAIN APP LOGIC */
    window.onload = function() {
        const pBtn = document.getElementById('btnPerson');
        if(pBtn) setMode('person', pBtn);
        const dBtn = document.getElementById('btnDesktop');
        if(dBtn) switchTab('desktop', dBtn);

        adjustLayout();
        updateSig();
        document.querySelectorAll('input').forEach(el => checkPh(el));
        setTimeout(() => { updateTab('modeSelector'); updateTab('previewTabs'); }, 100);
    };

    window.onresize = function() { adjustLayout(); updateTab('modeSelector'); updateTab('previewTabs'); };
    window.onscroll = function() {
        const h = document.getElementById('stickyHeader');
        const w = document.getElementById('floatWrapper');
        const g = document.getElementById('guide-anchor');
        if(window.scrollY>30) h.classList.add('scrolled'); else h.classList.remove('scrolled');
        if(g && g.getBoundingClientRect().top < window.innerHeight) w.classList.add('hidden'); else w.classList.remove('hidden');
    };
    function adjustLayout() { document.body.style.paddingTop = (document.querySelector('.main-header').offsetHeight + 30) + 'px'; }
    function updateTab(id) {
        const c = document.getElementById(id); const b = c.querySelector('.tab-btn.active'); const s = c.querySelector('.tab-slider');
        if(b && s) { s.style.width = b.offsetWidth + 'px'; s.style.left = b.offsetLeft + 'px'; }
    }

    /* === JELLY INTERACTION LOGIC === */
    function triggerJelly(element) {
        element.classList.remove('jelly-pop');
        void element.offsetWidth; // Force Reflow
        element.classList.add('jelly-pop');
    }

    let currentMode = 'person';
    let currentTab = 'desktop';

    function setMode(mode, btn) {
        currentMode = mode;
        const c = document.getElementById('modeSelector');
        c.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); updateTab('modeSelector');
        
        document.getElementById('formPerson').classList.toggle('active', mode === 'person');
        document.getElementById('formDept').classList.toggle('active', mode === 'dept');
        updateSig();
        document.querySelectorAll('input').forEach(el => checkPh(el));
    }

    function switchTab(tab, btn) {
        currentTab = tab;
        const c = document.getElementById('previewTabs');
        c.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); updateTab('previewTabs');
        
        document.getElementById('previewDesktop').style.display = (tab === 'desktop') ? 'block' : 'none';
        document.getElementById('previewMobile').style.display = (tab === 'mobile') ? 'block' : 'none';
        document.getElementById('noteText').innerHTML = (tab === 'desktop') ? '<strong>Desktop:</strong> เหมาะสำหรับ Outlook บนคอมพิวเตอร์' : '<strong>Mobile:</strong> เหมาะสำหรับ iPhone/Android (ข้อความล้วน)';
    }

    /* PLACEHOLDER & WARN TOGGLE */
    function checkPh(input) {
        const ph = input.parentElement.querySelector('.custom-placeholder');
        if(input.id === 'pPosition' && currentMode === 'person') {
            const warn = document.getElementById('warnPos');
            const hasDept = document.getElementById('pSection').value || document.getElementById('pDepartment').value;
            if(!input.value && hasDept) {
                warn.style.display = 'block'; if(ph) ph.style.display = 'none';
            } else {
                warn.style.display = 'none'; if(ph) ph.style.display = input.value ? 'none' : 'block';
            }
        } else {
            if(ph) {
                const warn = input.parentElement.querySelector('.warning-msg');
                const isWarn = warn && warn.style.display === 'block';
                ph.style.display = (input.value || isWarn) ? 'none' : 'block';
            }
        }
    }

    /* COPY FUNCTION */
    function copySignature() {
        const btn = document.querySelector('.btn-copy');
        const originalText = btn.innerText;
        let range, selection;

        if (currentTab === 'desktop') {
            const node = document.getElementById('previewDesktop');
            selection = window.getSelection();
            range = document.createRange();
            range.selectNodeContents(node);
            selection.removeAllRanges();
            selection.addRange(range);
        } else {
            // Mobile (Plain Text)
            const node = document.getElementById('mobContent');
            selection = window.getSelection();
            range = document.createRange();
            range.selectNodeContents(node);
            selection.removeAllRanges();
            selection.addRange(range);
        }

        try {
            document.execCommand('copy');
            // Feedback
            btn.innerText = "Copied!";
            btn.style.background = "linear-gradient(180deg, #28a745 0%, #218838 100%)";
            setTimeout(() => {
                btn.innerText = originalText;
                btn.style.background = ""; 
                window.getSelection().removeAllRanges();
            }, 2000);
        } catch (err) {
            console.error('Unable to copy', err);
            alert('Copy failed. Please select and copy manually.');
        }
    }

    /* SOFT JELLY BUBBLE LOGIC */
    const textWrapper = document.getElementById('bubbleTextWrapper');
    const bubbleText = document.getElementById('bubbleText');
    const textMeasurer = document.getElementById('textMeasurer');
    let isThaiBubble = true;

    function updateBubble() {
        const btn = document.getElementById('floatGuideBtn');
        const nextText = isThaiBubble ? "How to install?" : "วิธีติดตั้ง?";
        textMeasurer.innerText = nextText;
        const newW = textMeasurer.offsetWidth;
        
        bubbleText.style.opacity = '0';
        setTimeout(() => {
            isThaiBubble = !isThaiBubble;
            bubbleText.innerText = nextText;
            textWrapper.style.width = newW + 'px';
            bubbleText.style.opacity = '1';
            
            triggerJelly(btn);
            
        }, 300);
    }
    
    // Init
    textMeasurer.innerText = "วิธีติดตั้ง?";
    textWrapper.style.width = textMeasurer.offsetWidth + 'px';
    setInterval(updateBubble, 3000);

    function scrollToGuide() {
        document.getElementById('guide-anchor').scrollIntoView({behavior: 'smooth'});
        const btn = document.getElementById('acc-item-1');
        if (!btn.classList.contains('active')) btn.click();
    }

    function setGuideLang(lang) {
        document.getElementById('btnTh').classList.toggle('active', lang === 'th');
        document.getElementById('btnEn').classList.toggle('active', lang === 'en');
        document.querySelectorAll('[data-lang="th"]').forEach(e => e.style.display = lang === 'th' ? 'block' : 'none');
        document.querySelectorAll('[data-lang="en"]').forEach(e => e.style.display = lang === 'en' ? 'block' : 'none');
    }
    setGuideLang('th');

    /* LOGIC */
    function formatSpecialPhone(input) {
        let clean = input.replace(/\D/g, '');
        if (clean.length === 10 && clean.startsWith('0')) return '+66 (0) ' + clean.substring(1, 5) + ' ' + clean.substring(5);
        if (clean.length === 9 && clean.startsWith('0')) return '+66 (0) ' + clean.substring(1, 5) + ' ' + clean.substring(5);
        return input;
    }

    function validateInput(el, type) {
        const val = el.value;
        const icon = el.parentElement.querySelector('.valid-icon');
        const warn = el.parentElement.querySelector('.warning-msg');
        if(!icon) return;
        icon.style.display = 'none';
        if(warn && el.id !== 'pPosition') warn.style.display = 'none'; 
        el.classList.remove('input-error');
        if(!val) return; 

        let errorObj = null;
        if(type === 'en-name') { if(!/^[a-zA-Z]+(\s+[a-zA-Z]+)+$/.test(val)) errorObj = {th: "กรุณากรอกชื่อและนามสกุล (ภาษาอังกฤษ)", en: "Full name required (English)"}; } 
        else if(type === 'th-name') { if(!/^[ก-๙]+(\s+[ก-๙]+)+$/.test(val)) errorObj = {th: "กรุณากรอกชื่อและนามสกุล (ภาษาไทย)", en: "Full name required (Thai)"}; }
        else if(type === 'en') { if(/[\u0E00-\u0E7F]/.test(val)) errorObj = {th: "กรุณากรอกภาษาอังกฤษ", en: "English characters only"}; } 
        else if(type === 'th') { if(/[a-zA-Z]/.test(val)) errorObj = {th: "กรุณากรอกภาษาไทย", en: "Thai characters only"}; } 
        else if(type === 'email') { 
            if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val)) errorObj = {th: "รูปแบบอีเมลไม่ถูกต้อง", en: "Invalid Email format"};
            if(/[\u0E00-\u0E7F]/.test(val)) errorObj = {th: "ห้ามใช้ภาษาไทย", en: "No Thai characters"};
        } 
        else if(type === 'mobile') { if(val.replace(/\D/g, '').length !== 10) errorObj = {th: "กรุณากรอกเบอร์มือถือ 10 หลัก", en: "Mobile number must be 10 digits"}; }
        else if(type === 'tel') { if(val.replace(/\D/g, '').length !== 9) errorObj = {th: "กรุณากรอกเบอร์โทรศัพท์ 9 หลัก", en: "Phone number must be 9 digits"}; }

        if(errorObj) {
            if(warn) {
                warn.innerHTML = `<span class="th">⚠️ ${errorObj.th}</span><span class="en">⚠️ ${errorObj.en}</span>`;
                warn.style.display = 'block';
                const ph = el.parentElement.querySelector('.custom-placeholder');
                if(ph) ph.style.display = 'none';
            }
            el.classList.add('input-error');
        } else {
            icon.style.display = 'block';
        }
    }

    function updateSig() {
        try {
            const rawEmail = document.getElementById('inputEmail').value;
            const email = (rawEmail ? rawEmail.toLowerCase() : 'example@bgrimmpower.com');
            const customWeb = document.getElementById('inputWebsite').value;
            const customAddr = document.getElementById('inputAddress').value;
            const customComp = document.getElementById('inputCompany').value;
            
            let enName, thName, nameHTML;
            if (currentMode === 'person') {
                const rawEn = document.getElementById('pNameEng').value || 'Somchai Jaidee';
                enName = rawEn.toUpperCase(); 
                thName = document.getElementById('pNameTh').value || 'สมชาย ใจดี';
                validateInput(document.getElementById('pNameEng'), 'en-name');
                validateInput(document.getElementById('pNameTh'), 'th-name');
            } else {
                const rawEn = document.getElementById('dNameEng').value || 'Human Resources';
                enName = rawEn.toUpperCase(); 
                thName = document.getElementById('dNameTh').value || '';
                
                // DEPT VALIDATION
                if(document.getElementById('dNameEng').value) validateInput(document.getElementById('dNameEng'), 'en');
                if(document.getElementById('dNameTh').value) validateInput(document.getElementById('dNameTh'), 'th'); // Added TH validation
            }
            nameHTML = enName;
            if(thName) nameHTML += ` <span style="color:#FF6727;">&nbsp;|&nbsp;</span> ${thName}`;
            document.getElementById('sigNameContent').innerHTML = nameHTML;

            if (currentMode === 'person') {
                const pos = document.getElementById('pPosition').value;
                const sec = document.getElementById('pSection').value;
                const mainDep = document.getElementById('pDepartment').value;
                checkPh(document.getElementById('pPosition')); 
                if(!pos) {
                    document.getElementById('rowPosition').style.display = 'none';
                } else {
                    document.getElementById('rowPosition').style.display = 'table-row';
                    let deptStr = '';
                    if(sec && mainDep) deptStr = `${sec}, ${mainDep}`;
                    else if(sec) deptStr = sec;
                    else if(mainDep) deptStr = mainDep;
                    let posHTML = pos;
                    if(deptStr) posHTML += ` <span style="color:#63666F;">&nbsp;|&nbsp;</span> ${deptStr}`;
                    document.getElementById('prevPos').innerHTML = posHTML;
                }
            } else {
                document.getElementById('rowPosition').style.display = 'none';
            }

            const rawMob = document.getElementById('inputMobile').value;
            const rawTel = document.getElementById('inputTel').value;
            validateInput(document.getElementById('inputMobile'), 'mobile');
            validateInput(document.getElementById('inputTel'), 'tel');

            const cleanMob = rawMob.replace(/\D/g, '');
            let displayMob = rawMob;
            if(cleanMob.length === 10 && cleanMob.startsWith('0')) {
                displayMob = formatSpecialPhone(rawMob);
            }

            const cleanTel = rawTel.replace(/\D/g, '');
            let displayTel = rawTel;
            if(cleanTel.length === 9 && cleanTel.startsWith('0')) {
                displayTel = formatSpecialPhone(rawTel);
            }

            const wrapMob = document.getElementById('wrapMob');
            const wrapTel = document.getElementById('wrapTel');
            const lnkMob = document.getElementById('linkMobile');

            if (displayMob && (rawMob || currentMode === 'person')) {
                wrapMob.style.display = 'inline';
                lnkMob.innerText = displayMob;
                lnkMob.href = 'tel:' + displayMob.replace(/[^0-9+]/g, '');
            } else {
                wrapMob.style.display = 'none';
            }

            if (displayTel) {
                let telHTML = '';
                if (wrapMob.style.display !== 'none') telHTML += ` <span style="color:#63666F;">&nbsp;|&nbsp;</span> `;
                telHTML += `<strong>Phone</strong> <a href="tel:${displayTel.replace(/[^0-9+]/g, '')}" class="sig-link">${displayTel}</a>`;
                wrapTel.innerHTML = telHTML;
                wrapTel.style.display = 'inline';
            } else {
                wrapTel.style.display = 'none';
            }

            if (wrapMob.style.display === 'none' && wrapTel.style.display === 'none') {
                 document.getElementById('rowPhones').style.display = 'none';
            } else {
                 document.getElementById('rowPhones').style.display = 'table-row';
            }

            document.getElementById('linkEmail').innerText = email;
            document.getElementById('linkEmail').href = 'mailto:' + email;
            validateInput(document.getElementById('inputEmail'), 'email');

            // WEBSITE LOGIC (SMART)
            const defaultWeb = "www.bgrimmpower.com";
            let finalWeb = defaultWeb; 

            if (customWeb) {
                let cleanWeb = customWeb.toLowerCase().trim();
                cleanWeb = cleanWeb.replace(/^https?:\/\//, ''); 
                
                if(cleanWeb.startsWith('www.')) {
                    cleanWeb = cleanWeb.substring(4);
                }

                const parts = cleanWeb.split('.');
                const dotCount = parts.length - 1;
                
                let shouldAddWww = false;
                if(dotCount === 1) shouldAddWww = true; 
                else if(dotCount === 2 && cleanWeb.endsWith('.th')) shouldAddWww = true; 

                if(shouldAddWww) {
                    finalWeb = 'www.' + cleanWeb;
                } else {
                    finalWeb = cleanWeb;
                }
            }

            let finalHref = finalWeb;
            if(!finalHref.startsWith('http')) finalHref = 'https://' + finalHref;

            const webEl = document.getElementById('sigWebsite');
            if(webEl) {
                webEl.innerText = finalWeb;
                webEl.href = finalHref;
            }

            // COMPANY & ADDRESS
            const defaultComp = "B.Grimm Power PCL";
            const finalComp = customComp || defaultComp;
            
            // VALIDATE COMPANY (NEW)
            if(customComp) validateInput(document.getElementById('inputCompany'), 'en');

            const defaultAddr = "Dr. Gerhard Link Building, 5 Krungthepkreetha Road, Bangkok 10240, Thailand";
            const finalAddr = customAddr || defaultAddr;
            
            const compEl = document.getElementById('sigCompany');
            if(compEl) compEl.innerText = finalComp; // Removed .toUpperCase()
            
            const addrEl = document.getElementById('sigAddress');
            if(addrEl) addrEl.innerText = finalAddr;

            // --- MOBILE PREVIEW ---
            let mText = "--\n";
            mText += enName;
            if(thName) mText += ` | ${thName}`;
            mText += `\n`;
            
            if(currentMode === 'person') {
                const pos = document.getElementById('pPosition').value;
                const sec = document.getElementById('pSection').value;
                const mainDep = document.getElementById('pDepartment').value;
                if(pos) {
                    mText += pos;
                    if(sec || mainDep) {
                        let deptStr = '';
                        if(sec && mainDep) deptStr = `${sec}, ${mainDep}`;
                        else if(sec) deptStr = sec;
                        else if(mainDep) deptStr = mainDep;
                        mText += ` | ${deptStr}`;
                    }
                    mText += `\n`;
                }
            }
            
            mText += `${finalComp} | ${finalAddr}\n`;
            
            let phoneLine = "";
            if(displayMob && (rawMob || currentMode === 'person')) phoneLine += `Mobile ${displayMob}`;
            if(phoneLine && displayTel) phoneLine += ` | `;
            if(displayTel) phoneLine += `Phone ${displayTel}`;
            
            if(phoneLine) mText += phoneLine + `\n`;
            
            mText += `Email ${email} | ${finalWeb}`;
            document.getElementById('mobContent').innerText = mText;

        } catch(e) { console.log("Init render skip"); }
    }
    
    document.querySelectorAll('input').forEach(i => {
        i.addEventListener('input', function(){ this.classList.add('touched'); checkPh(this); updateSig(); });
    });
</script>

</body>
</html>
